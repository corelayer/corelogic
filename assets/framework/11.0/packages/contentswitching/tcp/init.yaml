name: init
tags:
  - tcp
  - core
sections:
  - name: trafficmanagement.contentswitching.policies
    elements:
      - name: INIT_IPV4_TCP
        tags:
          - ipv4
        fields:
          - id: name
            data: <<prefix>>_INIT_IPV4_TCP
          - id: expression
            data: <<core.placeholders.appexpert.expressions.advanced.CLIENT_IS_IPV4/data>>
        expressions:
          install: add cs policy <<name>> -rule q{<<expression>>}
          uninstall: rm cs policy <<name>>
      - name: INIT_IPV6_TCP
        tags:
          - ipv6
        fields:
          - id: name
            data: <<prefix>>_INIT_IPV6_TCP
          - id: expression
            data: <<core.placeholders.appexpert.expressions.advanced.CLIENT_IS_IPV6/data>>
        expressions:
          install: add cs policy <<name>> -rule q{<<expression>>}
          uninstall: rm cs policy <<name>>


  - name: trafficmanagement.contentswitching.policylabels
    elements:
      - name: INIT_TCP
        fields:
          - id: name
            data: <<prefix>>_INIT_TCP
          
        expressions:
          install: add cs policylabel <<name>> TCP
          uninstall: rm cs policylabel <<name>>

  - name: trafficmanagement.contentswitching.policylabelbindings
    elements:
      - name: INIT_IPV4_TCP
        tags:
          - ipv4
        fields:
          - id: name
            data: <<prefix>>_INIT_IPV4_TCP
          - id: label
            data: <<contentswitching.init.trafficmanagement.contentswitching.policylabels.INIT_TCP/name>>
          
          - id: 10041001_policy
            data: <<contentswitching.init.trafficmanagement.contentswitching.policies.INIT_IPV4_TCP/name>>
          - id: 10041001_policylabel
            data: <<contentswitching.init_ipv4.trafficmanagement.contentswitching.policylabels.INIT_IPV4_TCP/name>>

        expressions:
          install: bind cs policylabel <<label>> <<10041001_policy>> 10041001 -gotoPriorityExpression NEXT -invoke policylabel <<10041001_policylabel>>
          uninstall: unbind cs policylabel <<label>> <<10041001_policy>>


      - name: INIT_IPV6_TCP
        tags:
          - ipv6
        fields:
          - id: name
            data: <<prefix>>_INIT_IPV6_TCP
          - id: label
            data: <<contentswitching.init.trafficmanagement.contentswitching.policylabels.INIT_TCP/name>>
          
          - id: 10061001_policy
            data: <<contentswitching.init.trafficmanagement.contentswitching.policies.INIT_IPV6_TCP/name>>
          - id: 10061001_policylabel
            data: <<contentswitching.init_ipv6.trafficmanagement.contentswitching.policylabels.INIT_IPV6_TCP/name>>

        expressions:
          install: bind cs policylabel <<label>> <<10061001_policy>> 10061001 -gotoPriorityExpression NEXT -invoke policylabel <<10061001_policylabel>>
          uninstall: unbind cs policylabel <<label>> <<10061001_policy>>